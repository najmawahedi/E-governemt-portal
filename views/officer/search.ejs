<h2>Search Requests</h2>

<p>Welcome <strong><%= user.name %></strong> — Search requests in your department</p>

<div class="card mb-4">
  <div class="card-body">
    <form method="GET" action="/officer/search">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Citizen Name</label>
          <input type="text" class="form-control" name="citizen_name" value="<%= searchParams.citizen_name || '' %>">
        </div>
        <div class="col-md-2">
          <label class="form-label">Request ID</label>
          <input type="number" class="form-control" name="request_id" value="<%= searchParams.request_id || '' %>">
        </div>
        <div class="col-md-2">
          <label class="form-label">Status</label>
          <select class="form-select" name="status">
            <option value="">All Status</option>
            <option value="submitted" <%= searchParams.status === 'submitted' ? 'selected' : '' %>>Submitted</option>
            <option value="under_review" <%= searchParams.status === 'under_review' ? 'selected' : '' %>>Under Review</option>
            <option value="approved" <%= searchParams.status === 'approved' ? 'selected' : '' %>>Approved</option>
            <option value="rejected" <%= searchParams.status === 'rejected' ? 'selected' : '' %>>Rejected</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Service</label>
          <select class="form-select" name="service_id">
            <option value="">All Services</option>
            <% services.forEach(service => { %>
              <option value="<%= service.id %>" <%= searchParams.service_id == service.id ? 'selected' : '' %>>
                <%= service.name %>
              </option>
            <% }) %>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary me-2 w-100">Search</button>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-12">
          <a href="/officer/search" class="btn btn-secondary btn-sm">Clear Filters</a>
        </div>
      </div>
    </form>
  </div>
</div>

<% if (requests) { %>
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Search Results (<%= requests.length %> found)</h5>
    </div>
    <div class="card-body">
      <% if (requests.length === 0) { %>
        <p class="text-muted">No requests found matching your criteria.</p>
      <% } else { %>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th>Citizen</th>
              <th>Service</th>
              <th>Status</th>
              <th>Submitted</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% requests.forEach(r => { %>
              <tr>
                <td><%= r.id %></td>
                <td><%= r.citizen_name %></td>
                <td><%= r.service_name %></td>
                <td>
                  <span class="badge 
                    <% if (r.status === 'approved') { %>bg-success<% } %>
                    <% if (r.status === 'rejected') { %>bg-danger<% } %>
                    <% if (r.status === 'submitted' || r.status === 'under_review') { %>bg-warning<% } %>
                  ">
                    <%= r.status %>
                  </span>
                </td>
                <td><%= new Date(r.created_at).toLocaleDateString() %></td>
                <td>
                  <a href="/officer/requests/<%= r.id %>" class="btn btn-sm btn-primary">Review</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>
    </div>
  </div>
<% } %>

<div class="mt-3">
  <a href="/officer/dashboard" class="btn btn-secondary">← Back to Dashboard</a>
</div>